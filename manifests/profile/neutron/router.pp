# == Class: openstack::profile::neutron::router
#
# Copyright (c) 2015 Midokura SARL, All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
class openstack::profile::neutron::router {

  $controller_management_address = $::openstack::config::controller_address_management

  include ::openstack::common::neutron
  include ::midonet::midonet_agent

  class { '::neutron::agents::dhcp':
    debug            => $::openstack::config::debug,
    interface_driver => 'neutron.agent.linux.interface.MidonetInterfaceDriver',
    dhcp_driver      => 'midonet.neutron.agent.midonet_driver.DhcpNoOpDriver',
    enabled          => true,
  }

  class { '::neutron::agents::metadata':
    auth_password => $::openstack::config::neutron_password,
    shared_secret => $::openstack::config::neutron_shared_secret,
    auth_url      => "http://${controller_management_address}:35357/v2.0",
    debug         => $::openstack::config::debug,
    auth_region   => $::openstack::config::region,
    metadata_ip   => $controller_management_address,
    enabled       => true,
  }
}
